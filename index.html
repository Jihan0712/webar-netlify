<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebAR Experience</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.min.js"></script>
  <style>
    .loading { position: fixed; top: 0; width: 100%; text-align: center; background: black; color: white; z-index: 9999; }
  </style>
</head>
<body style="margin: 0; overflow: hidden;">
  <div class="loading" id="loader">Loading AR...</div>

  <a-scene 
    arjs="sourceType: webcam; debugUIEnabled: false;" 
    renderer="logarithmicDepthBuffer: true;"
    vr-mode-ui="enabled: false"
    id="scene"
    style="display: none;"
  >
    <!-- Dynamic NFT marker will be inserted here -->
  </a-scene>

  <script>
  const GIST_ID = "de164ff34fad007099e8bf2668ae1d61"; // ðŸ‘ˆ Your Gist ID

  fetch(`https://gist.githubusercontent.com/Jihan0712/${GIST_ID}/raw/ar-config.json`)
    .then(response => response.json())
    .then(config => {
      const scene = document.getElementById('scene');
      const markerName = config.markerName || 'my-logo';
      const mediaType = config.mediaType || 'image';
      const mediaUrl = config.mediaUrl || '';

      // Create NFT marker
      const nft = document.createElement('a-nft');
      nft.setAttribute('type', 'nft');
      nft.setAttribute('url', markerName); // This loads markerName.fset, .fset3, .jpg
      nft.setAttribute('smooth', 'true');
      nft.setAttribute('smoothCount', '10');
      nft.setAttribute('smoothTolerance', '0.01');
      nft.setAttribute('smoothThreshold', '5');

      // Add media content
      if (mediaType === 'image') {
        const img = document.createElement('a-image');
        img.setAttribute('src', mediaUrl);
        img.setAttribute('position', '0 0 0');
        img.setAttribute('scale', '1 1 1');
        nft.appendChild(img);
      } else if (mediaType === 'video') {
        const video = document.createElement('a-video');
        video.setAttribute('src', mediaUrl);
        video.setAttribute('position', '0 0 0');
        video.setAttribute('scale', '1.6 0.9 1');
        video.setAttribute('autoplay', 'true');
        video.setAttribute('loop', 'true');
        nft.appendChild(video);
      }

      scene.appendChild(nft);

      document.getElementById('loader').style.display = 'none';
      scene.style.display = 'block';
    })
    .catch(err => {
      console.error("Failed to load config", err);
      document.getElementById('loader').innerText = "Error loading AR content.";
    });
</script>
</body>
</html>